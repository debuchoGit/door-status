<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Door Status</title>
<style>
  body{
    margin:0;
    height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    font-family:-apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
  }
  #statusBox{
    font-size:80px;
    font-weight:900;
    text-align:center;
    padding:0 16px;
  }
</style>
</head>

<body>
<div id="statusBox">読み込み中...</div>

<script>
  const OWNER = "debuchoGit";
　const REPO  = "door-status";
　const PATH  = "Status.txt";
　const BRANCH = "main";
　const CONTENTS_API = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${PATH}?ref=${BRANCH}`;
　function applyStyle(text){
　  const box = document.getElementById("statusBox");
　　box.textContent = text || "（未設定）";
　　switch(text){
　　　case "入室可":
        document.body.style.backgroundColor = "#E3FCE3";
        box.style.color = "#000";
        break;
　　　case "会議中":
        document.body.style.backgroundColor = "#FF4B4B";
        box.style.color = "#FFF";
        break;
　　　case "電話中":
        document.body.style.backgroundColor = "#FFDD55";
        box.style.color = "#000";
        break;
　　　case "作業中":
        document.body.style.backgroundColor = "#87CEFA";
        box.style.color = "#000";
        break;
      case "外出中":
        document.body.style.backgroundColor = "#A8A8A8";
        box.style.color = "#000";
        break;
      case "不在":
        document.body.style.backgroundColor = "#555555";
        box.style.color = "#FFF";
        break;
      default:
        document.body.style.backgroundColor = "#FFFFFF";
        box.style.color = "#000";
    }
  }
  // base64(utf-8) を安全に文字列へ
  function b64ToUtf8(b64){
    const bin = atob(b64);
    const bytes = Uint8Array.from(bin, c => c.charCodeAt(0));
    return new TextDecoder("utf-8").decode(bytes);
  }
  async function update(){
    try{
      // 1) contents APIから blob sha を取る
      const metaRes = await fetch(CONTENTS_API + "&t=" + Date.now(), { cache: "no-store" });
      if(!metaRes.ok) throw new Error("META HTTP " + metaRes.status);
      const meta = await metaRes.json();
      const blobSha = meta.sha;
      if(!blobSha) throw new Error("shaが取れない");
      // 2) blob APIで中身(base64)を取る
      const BLOB_API = `https://api.github.com/repos/${OWNER}/${REPO}/git/blobs/${blobSha}`;
      const blobRes = await fetch(BLOB_API + "?t=" + Date.now(), { cache: "no-store" });
      if(!blobRes.ok) throw new Error("BLOB HTTP " + blobRes.status);
      const blob = await blobRes.json();
      const text = b64ToUtf8(blob.content || "").trim();
      applyStyle(text);
    } catch (e) {
      const box = document.getElementById("statusBox");
      box.textContent = "通信エラー:" + e;
      document.body.style.backgroundColor = "#000";
      box.style.color = "#fff";
    }
  }
  update();
  setInterval(update, 5000); // 5秒。重ければ10～15秒でもOK
</script> 
</body>
</html>
